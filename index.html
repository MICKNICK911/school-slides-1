<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Multi-Table Lesson Builder</title>
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <meta name="description" content="Enhanced Multi-Table Lesson Builder with Firebase integration">
</head>
<body>
    <!-- Login Screen -->
    <div class="modal" id="loginModal" style="display: flex;">
        <div class="modal-content">
            <h2 class="modal-title">Welcome to Lesson Builder</h2>
            <div class="input-group">
                <label for="loginEmail">Email:</label>
                <input type="email" id="loginEmail" class="filename-input" placeholder="your@email.com" value="test@example.com">
            </div>
            <div class="input-group">
                <label for="loginPassword">Password:</label>
                <input type="password" id="loginPassword" class="filename-input" placeholder="••••••••" value="password123">
            </div>
            <div id="loginMessage" class="message"></div>
            <div class="modal-actions">
                <button id="signInBtn" class="btn btn-primary">
                    <span class="btn-icon">→</span> Sign In
                </button>
                <button id="signUpBtn" class="btn btn-secondary">
                    <span class="btn-icon">+</span> Sign Up
                </button>
            </div>
            <div class="login-hint">
                <p>Use test@example.com / password123 for testing</p>
                <p><small>Note: You need to configure Firebase in firebaseConfig.js</small></p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" style="display: none;">
        <div class="container">
            <!-- Header -->
            <header class="app-header">
                <h1>
                    Enhanced Multi-Table Builder
                    <span id="userEmail" class="user-email"></span>
                    <button id="signOutBtn" class="btn btn-danger btn-sm">
                        <span class="btn-icon">←</span> Sign Out
                    </button>
                </h1>
                
                <!-- Table Management -->
                <div class="table-management-bar">
                    <div class="table-selector">
                        <label for="currentTable">Active Table:</label>
                        <select id="currentTable" class="table-dropdown">
                            <option value="">-- Select a Table --</option>
                        </select>
                        <button id="newTableBtn" class="btn btn-primary btn-sm">
                            <span class="btn-icon">+</span> New Table
                        </button>
                        <button id="renameTableBtn" class="btn btn-secondary btn-sm" disabled>
                            <span class="btn-icon">✎</span> Rename
                        </button>
                        <button id="deleteTableBtn" class="btn btn-danger btn-sm" disabled>
                            <span class="btn-icon">×</span> Delete
                        </button>
                    </div>
                    <div class="table-stats">
                        <span id="tableStats">No table selected</span>
                    </div>
                </div>
            </header>

            <!-- Content Columns -->
            <div class="content-columns">
                <!-- Dictionary Column -->
                <div class="column">
                    <div class="input-section">
                        <h2>Dictionary in <span id="currentTableName" class="table-name">No Table</span></h2>
                        
                        <div class="input-group">
                            <label for="editId">Select Entry to Edit:</label>
                            <select id="editId" disabled>
                                <option value="">-- Select a Table First --</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="topic">Topic:</label>
                            <input type="text" id="topic" disabled placeholder="Select or create a table first">
                        </div>
                        
                        <div class="input-group">
                            <label for="desc">Description:</label>
                            <textarea id="desc" rows="3" disabled></textarea>
                        </div>
                        
                        <div class="input-group">
                            <label for="ex">Examples (comma separated):</label>
                            <input type="text" id="ex" disabled>
                        </div>
                        
                        <div class="button-group">
                            <button id="addBtn" class="btn btn-primary" disabled>
                                <span class="btn-icon">+</span> Add Entry
                            </button>
                            <button id="updateBtn" class="btn btn-secondary" disabled>
                                <span class="btn-icon">↻</span> Update Entry
                            </button>
                            <button id="cancelBtn" class="btn btn-outline" disabled>
                                Cancel Edit
                            </button>
                        </div>
                        
                        <div class="button-group">
                            <div class="file-input-container">
                                <button class="btn btn-primary" id="importDictBtn" disabled>
                                    <span class="btn-icon">↑</span> Import Dictionary
                                </button>
                                <input type="file" id="importDictFile" class="file-input" accept=".json" disabled>
                            </div>
                            <button id="exportDictBtn" class="btn btn-secondary" disabled>
                                <span class="btn-icon">↓</span> Export Dictionary
                            </button>
                            <button id="clearDictBtn" class="btn btn-danger" disabled>
                                <span class="btn-icon">×</span> Clear Dictionary
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notes Column -->
                <div class="column">
                    <div class="input-section">
                        <h2>Notes in <span id="currentTableNameNotes" class="table-name">No Table</span></h2>
                        
                        <div class="input-group">
                            <label for="noteId">Select Note to Edit:</label>
                            <select id="noteId" disabled>
                                <option value="">-- Select a Table First --</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="noteTitle">Note Title:</label>
                            <input type="text" id="noteTitle" disabled>
                        </div>
                        
                        <div class="input-group">
                            <label for="noteContent">Content (Markdown Supported):</label>
                            <textarea id="noteContent" rows="6" disabled 
                                placeholder="Use *bold*, _italic_, -underline-, [colored], and + for bullets"></textarea>
                        </div>
                        
                        <div class="button-group">
                            <button id="addNoteBtn" class="btn btn-primary" disabled>
                                <span class="btn-icon">+</span> Save Note
                            </button>
                            <button id="updateNoteBtn" class="btn btn-secondary" disabled>
                                <span class="btn-icon">↻</span> Update Note
                            </button>
                            <button id="cancelNoteBtn" class="btn btn-outline" disabled>
                                Cancel
                            </button>
                        </div>
                        
                        <div class="button-group">
                            <div class="file-input-container">
                                <button class="btn btn-primary" id="importNotesBtn" disabled>
                                    <span class="btn-icon">↑</span> Import Notes
                                </button>
                                <input type="file" id="importNotesFile" class="file-input" accept=".json" disabled>
                            </div>
                            <button id="exportNotesBtn" class="btn btn-secondary" disabled>
                                <span class="btn-icon">↓</span> Export Notes
                            </button>
                            <button id="clearNotesBtn" class="btn btn-danger" disabled>
                                <span class="btn-icon">×</span> Clear Notes
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <section class="preview-section">
                <div class="preview-header">
                    <h2>Preview: <span id="previewTableName">No Table Selected</span></h2>
                    <div class="preview-tabs">
                        <button class="tab-button active" data-tab="dictionary">Dictionary</button>
                        <button class="tab-button" data-tab="notes">Notes</button>
                        <button class="tab-button" data-tab="raw-data">Raw Data</button>
                    </div>
                </div>
                
                <div class="search-areas">
                    <div class="search-box">
                        <input type="text" id="searchDictInput" disabled placeholder="Search dictionary entries...">
                    </div>
                    <div class="search-box">
                        <input type="text" id="searchNotesInput" disabled placeholder="Search notes...">
                    </div>
                </div>
                
                <div class="content-lists">
                    <div class="list-container">
                        <h3>Dictionary Entries <span id="dictCount" class="count-badge">0</span></h3>
                        <div class="entries-list" id="entriesList">
                            <div class="empty-state">Select a table to view entries</div>
                        </div>
                    </div>
                    
                    <div class="list-container">
                        <h3>Notes <span id="notesCount" class="count-badge">0</span></h3>
                        <div class="entries-list" id="notesList">
                            <div class="empty-state">Select a table to view notes</div>
                        </div>
                    </div>
                </div>
                
                <div class="preview-panels">
                    <div id="dictionary" class="tab-content active markdown-preview">
                        Select a table to preview dictionary entries
                    </div>
                    <div id="notes" class="tab-content markdown-preview">
                        Select a table to preview notes
                    </div>
                    <div id="raw-data" class="tab-content">
                        <pre id="preview">Select a table to view data</pre>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="tableModal">
        <div class="modal-content">
            <h3 class="modal-title" id="tableModalTitle">Create New Table</h3>
            <div class="input-group">
                <label for="tableName">Table Name:</label>
                <input type="text" id="tableName" class="filename-input" placeholder="e.g., Math Vocabulary, History Notes">
                <div id="tableNameError" class="error-message"></div>
            </div>
            <div class="modal-actions">
                <button id="cancelTableBtn" class="btn btn-danger">Cancel</button>
                <button id="confirmTableBtn" class="btn btn-primary">Create Table</button>
            </div>
        </div>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <h3 class="modal-title">Save Dictionary</h3>
            <div class="input-group">
                <label for="filename">File name:</label>
                <input type="text" id="filename" class="filename-input" value="dictionary.json">
            </div>
            <div class="modal-actions">
                <button id="cancelExport" class="btn btn-danger">Cancel</button>
                <button id="confirmExport" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h3 class="modal-title">Confirm Deletion</h3>
            <p>Are you sure you want to delete the entry "<span id="deleteTopic"></span>"?</p>
            <div class="modal-actions">
                <button id="cancelDelete" class="btn btn-secondary">Cancel</button>
                <button id="confirmDelete" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <div class="modal" id="importModal">
        <div class="modal-content">
            <h3 class="modal-title">Import Options</h3>
            <p>How would you like to import the data?</p>
            <div class="modal-actions">
                <button id="replaceData" class="btn btn-danger">Replace Current Data</button>
                <button id="mergeData" class="btn btn-primary">Merge with Current Data</button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmTableDeleteModal">
        <div class="modal-content">
            <h3 class="modal-title">Delete Table</h3>
            <p>Are you sure you want to delete the table "<span id="deleteTableName"></span>"?</p>
            <p class="warning-text">This will permanently delete ALL dictionary entries and notes in this table.</p>
            <div class="modal-actions">
                <button id="cancelTableDelete" class="btn btn-secondary">Cancel</button>
                <button id="confirmTableDelete" class="btn btn-danger">Delete Table</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <!-- Scripts -->
    <script type="module" src="scripts/app.js"></script>
</body>
</html>